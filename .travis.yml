sudo: required
dist: trusty
language: java
jobs:
  include:
    #Other modules can refer to oap-cache-oap to build independent travis-ci job,
    #oap-cache-oap is a CI building demo of the corresponding module oap-cache/oap.
    - name: oap-cache-oap
      before_install:
      - sudo apt-get install libpthread-stubs0-dev
      - sudo apt-get install libnuma-dev
      - sudo apt-get install cmake
      install:
      - # Download spark 3.0.0
      - "[ -f spark ] || mkdir spark && cd spark"
      - "git clone -b v3.0.0-rc1 https://github.com/apache/spark.git"
      - "cd spark"
      - "./build/mvn -DskipTests clean -Pyarn  -Phive-1.2 -Phive-thriftserver  install -q"
      - "export SPARK_HOME=`pwd`/spark"
      before_script:
        - cd ${TRAVIS_BUILD_DIR}/dev
        - ./install_vmemcache.sh
        - ./install_memkind.sh
      script:
        - cd ${TRAVIS_BUILD_DIR}
        - mvn clean test -pl  com.intel:oap-cache-oap -q -Ppersistent-memory  -Pvmemcache  -am